name: Test Action

on: [push, workflow_dispatch]

jobs:
  test-generation:
    runs-on: ubuntu-latest
    name: Test PDF Generation
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create Dummy Assets
        run: |
          mkdir -p assets
          printf "@startuml\nUser->System:Test\n@enduml" > assets/diagram.puml
          # Create a tiny red dot SVG
          echo '<svg width="10" height="10"><circle cx="5" cy="5" r="4" fill="red"/></svg>' > assets/image.svg

      - name: Create Test Requirements
        run: |
          echo "id,description,priority,reference to,attached files" > requirements.csv
          echo "G.1.1,Testing PDF gen.,Low,,assets/diagram.puml" >> requirements.csv
          echo "S.1.1,Testing Image.,High,,assets/image.svg" >> requirements.csv
          echo "P.1.1,Senior developer Hugo.,Medium,," >> requirements.csv
          echo "E.1.1,PEGS stands for Project Environment Goals System.,Low,," >> requirements.csv
          echo "G.2.1,The system shall run on Linux.,High,," >> requirements.csv
          echo "S.2.1,The system shall have a 3-tier architecture.,High,G.1.1,assets/diagram.puml|Primary Architecture;assets/image.svg|Context Diagram" >> requirements.csv
          echo "P.3.1,Project management rules.,High,," >> requirements.csv
          echo "P.4.1,Validation strategy.,High,," >> requirements.csv
          echo "E.3.1,System constraints.,High,," >> requirements.csv
          echo "G.3.1,Expected benefits.,Medium,," >> requirements.csv
          echo "G.7.1,Stakeholders list.,Low,," >> requirements.csv

      - name: Run PEGS Specs Action
        uses: ./
        with:
          requirements-path: "requirements.csv"
          output-dir: "docs/build"
          project-name: "PEGS Demo Project"
          authors: "Hugo, LÃ©a"
          logo-path: "assets/image.svg"

      - name: Verify Artifacts
        run: |
          ls -R docs/build
          if [ ! -f docs/build/full-specs.pdf ]; then
            echo "full-specs.pdf not generated!"
            exit 1
          fi

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: generated-specs-pdf
          path: docs/build/full-specs.pdf
