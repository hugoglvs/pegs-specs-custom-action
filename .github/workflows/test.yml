name: Test Action

on: [push, workflow_dispatch]

jobs:
    test-generation:
        runs-on: ubuntu-latest
        name: Test PDF Generation
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Create Dummy Assets
              run: |
                  mkdir -p assets
                  echo '@startuml\nUser->System:Test\n@enduml' > assets/diagram.puml
                  # Create a tiny red dot SVG
                  echo '<svg width="10" height="10"><circle cx="5" cy="5" r="4" fill="red"/></svg>' > assets/image.svg

            - name: Create Test Requirements
              run: |
                  echo "id,book,chapter,description,reference to,attached files" > requirements.csv
                  echo "REQ-1,Goals Book,Context and overall objective,Testing PDF gen.,,assets/diagram.puml" >> requirements.csv
                  echo "REQ-2,System Book,Components,Testing Image.,,assets/image.svg" >> requirements.csv

            - name: Run PEGS Specs Action
              uses: ./
              with:
                  requirements-path: "requirements.csv"
                  output-dir: "docs/build"

            - name: Verify Artifacts
              run: |
                  ls -R docs/build
                  # Check for Goals Book
                  if [ ! -f docs/build/goals-book.pdf ]; then
                    echo "Goals Book PDF not generated!"
                    exit 1
                  fi
                  # Check for System Book
                  if [ ! -f docs/build/system-book.pdf ]; then
                    echo "System Book PDF not generated!"
                    exit 1
                  fi

            - name: Upload Artifacts
              uses: actions/upload-artifact@v4
              with:
                  name: generated-specs
                  path: docs/build
