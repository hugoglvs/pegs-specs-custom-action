{"version":3,"names":["_getJestObj","mock","promises","readFile","jest","fn","existsSync","_validator","require","fs","_interopRequireWildcard","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","describe","validator","mockReadFile","mockExistsSync","beforeEach","RequirementValidator","clearAllMocks","mockReturnValue","mockImplementation","path","includes","Promise","resolve","it","reqs","id","book","chapter","description","result","validate","expect","isValid","toBe","errors","toHaveLength","parent","warnings","toContain"],"sources":["validator.test.ts"],"sourcesContent":["import { RequirementValidator } from '../src/validator';\nimport { Requirement } from '../src/types';\nimport * as fs from 'fs';\n\n// Mock fs to control template reading\njest.mock('fs', () => ({\n    promises: {\n        readFile: jest.fn()\n    },\n    existsSync: jest.fn()\n}));\n\ndescribe('RequirementValidator', () => {\n    let validator: RequirementValidator;\n    const mockReadFile = fs.promises.readFile as jest.Mock;\n    const mockExistsSync = fs.existsSync as jest.Mock;\n\n    beforeEach(() => {\n        validator = new RequirementValidator('templates');\n        jest.clearAllMocks();\n\n        // Mock template existence\n        mockExistsSync.mockReturnValue(true);\n\n        // Mock template content building a standard PEGS map\n        mockReadFile.mockImplementation((path: string) => {\n            if (path.includes('goals.adoc')) {\n                return Promise.resolve(\n                    '== G.1 Context and overall objective\\n' +\n                    '== G.2 Current situation'\n                );\n            }\n            if (path.includes('system.adoc')) {\n                return Promise.resolve(\n                    '== S.1 Components\\n' +\n                    '== S.2 Functionality'\n                );\n            }\n            if (path.includes('environment.adoc')) {\n                return Promise.resolve('== E.1 Glossary');\n            }\n            if (path.includes('project.adoc')) {\n                return Promise.resolve('== P.1 Roles');\n            }\n            return Promise.resolve('');\n        });\n    });\n\n    describe('Valid Requirements (Happy Path)', () => {\n        it('should validate a simple correct ID', async () => {\n            const reqs: Requirement[] = [{\n                id: 'S.1.1',\n                book: 'System Book',\n                chapter: 'Components',\n                description: 'test'\n            }];\n            const result = await validator.validate(reqs);\n            expect(result.isValid).toBe(true);\n            expect(result.errors).toHaveLength(0);\n        });\n\n        it('should validate a nested ID consistent with parent', async () => {\n            const reqs: Requirement[] = [{\n                id: 'G.1.2.1',\n                book: 'Goals Book',\n                chapter: 'Context and overall objective',\n                parent: 'G.1.2',\n                description: 'test'\n            }];\n            const result = await validator.validate(reqs);\n            expect(result.isValid).toBe(true);\n        });\n    });\n\n    describe('Warnings', () => {\n        it('should warn on deep nesting (> 6 levels)', async () => {\n            const reqs: Requirement[] = [{\n                id: 'S.1.2.3.4.5.6.7', // 7 levels\n                book: 'System Book',\n                chapter: 'Components',\n                description: 'deep'\n            }];\n            const result = await validator.validate(reqs);\n            expect(result.isValid).toBe(true); // Still valid format\n            expect(result.warnings).toHaveLength(1);\n            expect(result.warnings[0]).toContain('Nesting is very deep');\n        });\n    });\n\n    describe('Invalid Requirements (Failures)', () => {\n        it('should fail on invalid ID format', async () => {\n            const reqs: Requirement[] = [{\n                id: 'S-1', // Invalid separator\n                book: 'System Book',\n                chapter: 'Components',\n                description: 'bad'\n            }];\n            const result = await validator.validate(reqs);\n            expect(result.isValid).toBe(false);\n            expect(result.errors[0]).toContain('ID format invalid');\n        });\n\n        it('should fail when Book letter mismatches', async () => {\n            const reqs: Requirement[] = [{\n                id: 'G.1.1', // G matches Goals Book, but...\n                book: 'System Book', // ...we say it is System Book (Expect S)\n                chapter: 'Components',\n                description: 'mismatch'\n            }];\n            const result = await validator.validate(reqs);\n            expect(result.isValid).toBe(false);\n            expect(result.errors[0]).toContain('expected \\'S\\'');\n        });\n\n        it('should fail when Chapter number mismatches', async () => {\n            const reqs: Requirement[] = [{\n                id: 'S.2.1', // Indicates chapter 2\n                book: 'System Book',\n                chapter: 'Components', // Mocks say Components is S.1\n                description: 'mismatch'\n            }];\n            const result = await validator.validate(reqs);\n            expect(result.isValid).toBe(false);\n            expect(result.errors[0]).toContain('expected 1');\n        });\n\n        it('should fail when Parent ID is not a prefix of Child ID', async () => {\n            const reqs: Requirement[] = [{\n                id: 'S.1.2',\n                book: 'System Book',\n                chapter: 'Components',\n                parent: 'S.2', // Child S.1.2 is NOT child of S.2\n                description: 'bad parent'\n            }];\n            const result = await validator.validate(reqs);\n            expect(result.isValid).toBe(false);\n            expect(result.errors[0]).toContain('Child ID must start with Parent ID');\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}